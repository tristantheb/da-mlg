function Start(){var e="1.1.2",a="tristantheb Production";$("link[disabled]").removeAttr("disabled"),$("textarea").val(""),console.info("Version: "+e+"\nAuthor: "+a)}function dateCheck(){if(nowDay=(new Date).getDate(),nowDay>15){if("Lien interne Garantie Jeunes"==$("#key_type").text())return;var e='<div class="alert alert-danger"><h4><i class="fad fa-lock-alt"></i> Période de fermeture</h4><p class="m-0">Les déclarations sont maintenant fermées, elles doivent être effectuées entre le 1er et le 15 du mois uniquement.</p></div>';$("#step1").html(e),$("#step1").removeClass("card card-primary card-outline"),$("#step2").remove(),$("#step3").remove(),$("#step4").remove()}}function logControl(){$("*").on("click keydown change",function(e){console.log(e)})}function complete_group(){var e=$("#surname").val(),a=$("#lastname").val();$.ajax({type:"POST",url:"./includes/group_checker.php",data:{surname:e,lastname:a},dataType:"json",success:function(e){""===e.error?($("#group").val(e.group),$("select#advisor").attr("disabled",!0),$("option#val"+e.advisor).attr("selected",!0),$("#error").html("&nbsp;"),$("*").removeClass("is-invalid")):($("#group").addClass("is-invalid"),$("#error").html('<div class="alert alert-warning"><h4>Information :</h4><p>'+e.error+"</p></div>"))},error:function(e,a){0==e.status?alert("Vous êtes hors ligne !!\n Vérifiez votre connexion internet."):404==e.status?alert("L'URL demandée n'est pas trouvée."):500==e.status?alert("Erreur interne au serveur."):"parsererror"==a?alert("Erreur.\nTransmission de la requête JSON échouée."):"timeout"==a?alert("Temps de requête écoulé."):alert("Erreur inconnue.\n"+e.responseText)}})}function interimCheck(e){Swal.fire({title:"Vous êtes sûr ?",text:"Vous déclarez avoir travaillé en Intérim, attention ! Si ce n'est pas le cas, vous serez sanctionné.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Annuler",confirmButtonText:"Confirmer"}).then(e=>{e.value?Swal.fire("Ok","Vous avez donc travaillé en intérim.","success"):$("#st3_interim").prop("checked",!1)})}function nextStep(e=0){if(1==e){$("*").removeClass("is-invalid");var a=[],t=0;""!=$("#month").val()&&1!=$.isNumeric($("#month").val())||(t++,a.push('- La case "Mois" n\'est pas remplie, vous devez écrire en lettres.'),$("#month").addClass("is-invalid")),(""==$("#year").val()||$("#year").val().length>2)&&(t++,a.push('- La case "Année" n\'est pas remplie, vous devez écrire les deux derniers chiffres.'),$("#year").addClass("is-invalid")),""==$("#lastname").val()&&(t++,a.push('- La case "Nom" n\'est pas remplie'),$("#lastname").addClass("is-invalid")),""==$("#surname").val()&&(t++,a.push('- La case "Prénom" n\'est pas remplie'),$("#surname").addClass("is-invalid")),(""==$("#group").val()||$("#group").val().length>7)&&(t++,a.push('- La case "Groupe" n\'est pas remplie, il faut cliquer dans la case.'),$("#group").addClass("is-invalid")),$("#advisor")[0].selectedIndex<=0&&(t++,a.push('- La case "Conseiller(ère)" n\'est pas remplie'),$("#advisor").addClass("is-invalid")),$("#activity")[0].selectedIndex<=0&&(t++,a.push('- La case "Activité" n\'est pas remplie, vous devez sélectionner ce que vous avez fait le mois passé.'),$("#activity").addClass("is-invalid")),0==$("#i_st2_work").prop("checked")&&0==$("#i_st2_seminar").prop("checked")&&0==$("#i_st2_steps").prop("checked")&&0==$("#i_st2_applications").prop("checked")&&0==$("#i_st2_education").prop("checked")&&0==$("#r_st2_other").prop("checked")&&0==$("#r_st2_nothing").prop("checked")&&0==$("#i_st2_new").prop("checked")&&(t++,a.push("- Vous n'avez coché aucune case. Vous devez donner au moins une activitée.")),""==$("#st2_work").val()&&""==$("#st2_seminar").val()&&""==$("#st2_steps").val()&&""==$("#st2_applications").val()&&""==$("#st2_education").val()&&""==$("#st2_other").val()&&""==$("#st2_nothing").val()&&0==$("#i_st2_new").prop("checked")&&(t++,a.push("- Vous ne décrivez rien dans les cases de démarches. Il faut remplir les zone de texte.")),0==t?($("#error").html("&nbsp;"),$("*").removeClass("is-invalid"),nextStep()):(a=a.join("<br>"),pageUp(),$("#error").html('<div class="alert alert-warning alert-dismissible"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><h5><i class="icon fas fa-exclamation-triangle"></i> Alerte !</h5>Tous les champs obligatoires ne sont pas complétés !<br><br>'+a+"</div>"),Swal.fire("Attention !",a,"warning"))}else $("#error").html(),document.getElementById("step"+step).style.display="none",step+=1,document.getElementById("step"+step).style.display="block",pageUp(),console.info("Step : "+step)}function prevStep(){document.getElementById("step"+step).style.display="none",step-=1,document.getElementById("step"+step).style.display="block",pageUp(),console.info("Step : "+step)}function stepShow(e){document.getElementById("opt"+e).style.display="block",null!=selected?(document.getElementById(selected).style.display="none",selected="opt"+e):selected="opt"+e}function submit(){$("*").removeClass("is-invalid");var e,a=$("#month").val(),t="20"+$("#year").val(),s=$("#lastname").val(),n=$("#surname").val(),i=$("#group").val(),r=$("#advisor").val();switch($("#activity").val()){case"1":e="J'ai travaillé de manière rémunérée auprès d'un ou plusieurs employeurs ce qui m'a permis d'acquérir de l'expérience professionnelle";break;case"2":e="J'ai réalisé différentes démarches pour ma mobilité/santé, des dépots de candidatures, ou j'ai participé à des événements/ateliers";break;case"3":e="J'ai suivi une formation certifiante/qualifiante";break;case"4":e="J'ai effectué d'autres démarches";break;case"5":e="J'entre en Garantie Jeunes"}var l=$("#st2_work").val(),o=$("#st2_seminar").val(),d=$("#st2_steps").val(),c=$("#st2_applications").val(),p=$("#st2_education").val(),u=$("#st2_other").val(),m=$("#st2_nothing").val(),h=$("#st3_pay").val(),v=$("#st3_interim").prop("checked"),_=$("#st3_salaire").prop("checked"),f=$("#st3_rsa").prop("checked"),g=$("#st3_ape").prop("checked"),k=$("#st3_pri_a").prop("checked"),y=$("#st3_aah").prop("checked"),b=$("#st3_pen_a").prop("checked"),w=$("#st3_rs").prop("checked"),C=$("#st3_other").prop("checked"),x=$("#key").val(),S=$("#type_key").val(),z=$("#certify").prop("checked");if(1==v&&""==h)h="no";else if(1==v&&""!=h)return $("#st3_pay").addClass("is-invalid"),$("#st3_interim").addClass("is-invalid"),$("#error").html('<div class="alert alert-warning alert-dismissible"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><h5><i class="icon fas fa-exclamation-triangle"></i> Alerte !</h5>Le formulaire contient une contradiction affichée en rouge.</div>'),!1;""!=h?$.isNumeric(h)||1==v?1==z?($("#error").html("&nbsp;"),console.info("Start ajax POST"),$.ajax({type:"POST",url:"./includes/form_submit.php",data:{month:a,year:t,lastname:s,surname:n,group:i,advisor:r,activity:e,st2_work:l,st2_seminar:o,st2_steps:d,st2_applications:c,st2_education:p,st2_other:u,st2_nothing:m,st3_pay:h,st3_interim:v,st3_salaire:_,st3_rsa:f,st3_ape:g,st3_pri_a:k,st3_aah:y,st3_pen_a:b,st3_rs:w,st3_other:C,key:x,type_key:S,certify:z},dataType:"json",success:function(v){if(1==v.msg&&0==v.warn){console.info("Start generating pdf values");var x="";l&&(x+=l+"\n"),o&&(x+=o+"\n"),d&&(x+=d+"\n"),c&&(x+=c+"\n"),p&&(x+=p+"\n"),u&&(x+=u+"\n"),m&&(x+=m+"\n");var S="";S+='<div class="card-header"><h3 class="card-title">Étape 4 - Générer le PDF et Imprimer sa déclaration</h3></div>',S+='<div class="card-body">C\'est la dernière étape ! Cliquez sur le bouton pour générer le PDF de votre déclaration, imprimez votre feuille et allez la signer.<br>',S+='<input name="month" value="'+a+'" hidden>',S+='<input name="year" value="'+t+'" hidden>',S+='<input name="lastname" value="'+s+'" hidden>',S+='<input name="surname" value="'+n+'" hidden>',S+='<input name="advisor" value="'+r+'" hidden>',S+='<input name="group" value="'+i+'" hidden>',S+='<input name="activity" value="'+e+'" hidden>',S+='<textarea name="activity_feed" hidden>'+x+"</textarea>",$("#i_st2_work").prop("checked")&&(S+='<input name="st2_work" value="J\'ai travaillé durant le mois de "'+a+'" "'+t+'" chez "'+l+'" hidden>'),$("#i_st2_seminar").prop("checked")&&(S+='<input name="st2_seminar" value="J\'ai été à des ateliers/événements : "'+o+'" hidden>'),$("#i_st2_steps").prop("checked")&&(S+='<input name="st2_steps" value="J\'ai effectué des démarches aurpès des entreprises : "'+d+'" hidden>'),$("#i_st2_applications").prop("checked")&&(S+='<input name="st2_applications" value="J\'ai déposé des CVs chez : "'+c+'" hidden>'),$("#i_st2_education").prop("checked")&&(S+='<input name="st2_education" value="J\'ai été en formation : "'+p+'" hidden>'),$("#r_st2_other").prop("checked")&&(S+='<input name="st2_other" value="J\'ai effectué : "'+u+'" hidden>'),$("#r_st2_nothing").prop("checked")&&(S+='<input name="st2_nothing" value="Je n\'ai rien effectué car : '+m+'" hidden>'),S+='<input name="pay" value="'+h+'" hidden>',S+=1==_?'<input name="chk_salaire" value="d\'un salaire;" hidden>':'<input name="chk_salaire" value="" hidden>',S+=1==f?'<input name="chk_rsa" value="du RSA;" hidden>':'<input name="chk_rsa" value="" hidden>',S+=1==g?'<input name="chk_ape" value="d\'une prime pôle emploi;" hidden>':'<input name="chk_ape" value="" hidden>',S+=1==k?'<input name="chk_pri_a" value="d\'une prime d\'activité;" hidden>':'<input name="chk_pri_a" value="" hidden>',S+=1==y?'<input name="chk_aah" value="de l\'AAH;" hidden>':'<input name="chk_aah" value="" hidden>',S+=1==b?'<input name="chk_pen_a" value="de la Pension Alimentaire;" hidden>':'<input name="chk_pen_a" value="" hidden>',S+=1==w?'<input name="chk_rs" value="d\'un stage ;" hidden>':'<input name="chk_rs" value="" hidden>',S+=1==C?'<input name="chk_other" value="d\'autre chose ;" hidden>':'<input name="chk_other" value="" hidden>',S+='<input class="btn btn-primary" name="generate" type="submit" value="Générer le PDF"></div>',$("#step4").html(S),console.info("Table generated"),nextStep(),console.info("Page loaded")}else 1==v.warn?(pageUp(),$("#error").html('<div class="alert alert-danger alert-dismissible"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><h5><i class="icon fas fa-exclamation-triangle"></i> Alerte !</h5>'+v.msg+"</div>"),Swal.fire({title:"Alerte",text:v.msg,icon:"error",timer:6e4,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1})):(pageUp(),$("#error").html('<div class="alert alert-warning alert-dismissible"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><h5><i class="icon fas fa-exclamation-triangle"></i> Alerte !</h5>'+v.msg+"</div>"),Swal.fire("Attention",v.msg,"warning"))},error:function(e,a){0==e.status?alert("Vous êtes hors ligne !!\n Vérifiez votre connexion internet."):404==e.status?alert("L'URL demandée n'est pas trouvée."):500==e.status?alert("Erreur interne au serveur."):"parsererror"==a?alert("Erreur.\nTransmission de la requête JSON échouée."):"timeout"==a?alert("Temps de requête écoulé."):alert("Erreur inconnue.\n"+e.responseText)}})):(pageUp(),$("#certify").addClass("is-invalid"),$("#error").html('<div class="alert alert-warning alert-dismissible"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><h5><i class="icon fas fa-exclamation-triangle"></i> Alerte !</h5>Votre déclaration d\'activité n\'est pas certifiée. Si vous ne cochez pas cette case, votre document ne sera pas validé.</div>')):(pageUp(),$("#st3_pay").addClass("is-invalid"),$("#error").html('<div class="alert alert-warning alert-dismissible"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><h5><i class="icon fas fa-exclamation-triangle"></i> Alerte !</h5>Vous ne pouvez pas indiquer un montant en lettres.</div>')):(pageUp(),$("#st3_pay").addClass("is-invalid"),$("#error").html('<div class="alert alert-warning alert-dismissible"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><h5><i class="icon fas fa-exclamation-triangle"></i> Alerte !</h5>Vous n\'avez indiqué aucun montant !</div>'))}function pageUp(){$(window).scrollTop(-1e3),console.info("ScrollTop")}var selected,step=0;$(document).ready(function(){Start(),step+=1,console.info("Step : "+step),document.getElementById("step"+step).style.display="block",dateCheck()});